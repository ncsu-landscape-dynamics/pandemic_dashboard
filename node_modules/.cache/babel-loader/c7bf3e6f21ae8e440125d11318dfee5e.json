{"ast":null,"code":"'use strict';\n\nvar MapiResponse = require('../classes/mapi-response');\n\nvar MapiError = require('../classes/mapi-error');\n\nvar constants = require('../constants');\n\nvar parseHeaders = require('../helpers/parse-headers'); // Keys are request IDs, values are XHRs.\n\n\nvar requestsUnderway = {};\n\nfunction browserAbort(request) {\n  var xhr = requestsUnderway[request.id];\n  if (!xhr) return;\n  xhr.abort();\n  delete requestsUnderway[request.id];\n}\n\nfunction createResponse(request, xhr) {\n  return new MapiResponse(request, {\n    body: xhr.response,\n    headers: parseHeaders(xhr.getAllResponseHeaders()),\n    statusCode: xhr.status\n  });\n}\n\nfunction normalizeBrowserProgressEvent(event) {\n  var total = event.total;\n  var transferred = event.loaded;\n  var percent = 100 * transferred / total;\n  return {\n    total: total,\n    transferred: transferred,\n    percent: percent\n  };\n}\n\nfunction sendRequestXhr(request, xhr) {\n  return new Promise(function (resolve, reject) {\n    xhr.onprogress = function (event) {\n      request.emitter.emit(constants.EVENT_PROGRESS_DOWNLOAD, normalizeBrowserProgressEvent(event));\n    };\n\n    var file = request.file;\n\n    if (file) {\n      xhr.upload.onprogress = function (event) {\n        request.emitter.emit(constants.EVENT_PROGRESS_UPLOAD, normalizeBrowserProgressEvent(event));\n      };\n    }\n\n    xhr.onerror = function (error) {\n      reject(error);\n    };\n\n    xhr.onabort = function () {\n      var mapiError = new MapiError({\n        request: request,\n        type: constants.ERROR_REQUEST_ABORTED\n      });\n      reject(mapiError);\n    };\n\n    xhr.onload = function () {\n      delete requestsUnderway[request.id];\n\n      if (xhr.status < 200 || xhr.status >= 400) {\n        var mapiError = new MapiError({\n          request: request,\n          body: xhr.response,\n          statusCode: xhr.status\n        });\n        reject(mapiError);\n        return;\n      }\n\n      resolve(xhr);\n    };\n\n    var body = request.body; // matching service needs to send a www-form-urlencoded request\n\n    if (typeof body === 'string') {\n      xhr.send(body);\n    } else if (body) {\n      xhr.send(JSON.stringify(body));\n    } else if (file) {\n      xhr.send(file);\n    } else {\n      xhr.send();\n    }\n\n    requestsUnderway[request.id] = xhr;\n  }).then(function (xhr) {\n    return createResponse(request, xhr);\n  });\n} // The accessToken argument gives this function flexibility\n// for Mapbox's internal client.\n\n\nfunction createRequestXhr(request, accessToken) {\n  var url = request.url(accessToken);\n  var xhr = new window.XMLHttpRequest();\n  xhr.open(request.method, url);\n  Object.keys(request.headers).forEach(function (key) {\n    xhr.setRequestHeader(key, request.headers[key]);\n  });\n  return xhr;\n}\n\nfunction browserSend(request) {\n  return Promise.resolve().then(function () {\n    var xhr = createRequestXhr(request, request.client.accessToken);\n    return sendRequestXhr(request, xhr);\n  });\n}\n\nmodule.exports = {\n  browserAbort: browserAbort,\n  sendRequestXhr: sendRequestXhr,\n  browserSend: browserSend,\n  createRequestXhr: createRequestXhr\n};","map":{"version":3,"sources":["/Users/garrettmillar/pandemic_dashboard/node_modules/@mapbox/mapbox-sdk/lib/browser/browser-layer.js"],"names":["MapiResponse","require","MapiError","constants","parseHeaders","requestsUnderway","browserAbort","request","xhr","id","abort","createResponse","body","response","headers","getAllResponseHeaders","statusCode","status","normalizeBrowserProgressEvent","event","total","transferred","loaded","percent","sendRequestXhr","Promise","resolve","reject","onprogress","emitter","emit","EVENT_PROGRESS_DOWNLOAD","file","upload","EVENT_PROGRESS_UPLOAD","onerror","error","onabort","mapiError","type","ERROR_REQUEST_ABORTED","onload","send","JSON","stringify","then","createRequestXhr","accessToken","url","window","XMLHttpRequest","open","method","Object","keys","forEach","key","setRequestHeader","browserSend","client","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nvar MapiResponse = require('../classes/mapi-response');\nvar MapiError = require('../classes/mapi-error');\nvar constants = require('../constants');\nvar parseHeaders = require('../helpers/parse-headers');\n\n// Keys are request IDs, values are XHRs.\nvar requestsUnderway = {};\n\nfunction browserAbort(request) {\n  var xhr = requestsUnderway[request.id];\n  if (!xhr) return;\n  xhr.abort();\n  delete requestsUnderway[request.id];\n}\n\nfunction createResponse(request, xhr) {\n  return new MapiResponse(request, {\n    body: xhr.response,\n    headers: parseHeaders(xhr.getAllResponseHeaders()),\n    statusCode: xhr.status\n  });\n}\n\nfunction normalizeBrowserProgressEvent(event) {\n  var total = event.total;\n  var transferred = event.loaded;\n  var percent = (100 * transferred) / total;\n  return {\n    total: total,\n    transferred: transferred,\n    percent: percent\n  };\n}\n\nfunction sendRequestXhr(request, xhr) {\n  return new Promise(function(resolve, reject) {\n    xhr.onprogress = function(event) {\n      request.emitter.emit(\n        constants.EVENT_PROGRESS_DOWNLOAD,\n        normalizeBrowserProgressEvent(event)\n      );\n    };\n\n    var file = request.file;\n    if (file) {\n      xhr.upload.onprogress = function(event) {\n        request.emitter.emit(\n          constants.EVENT_PROGRESS_UPLOAD,\n          normalizeBrowserProgressEvent(event)\n        );\n      };\n    }\n\n    xhr.onerror = function(error) {\n      reject(error);\n    };\n\n    xhr.onabort = function() {\n      var mapiError = new MapiError({\n        request: request,\n        type: constants.ERROR_REQUEST_ABORTED\n      });\n      reject(mapiError);\n    };\n\n    xhr.onload = function() {\n      delete requestsUnderway[request.id];\n      if (xhr.status < 200 || xhr.status >= 400) {\n        var mapiError = new MapiError({\n          request: request,\n          body: xhr.response,\n          statusCode: xhr.status\n        });\n        reject(mapiError);\n        return;\n      }\n      resolve(xhr);\n    };\n\n    var body = request.body;\n\n    // matching service needs to send a www-form-urlencoded request\n    if (typeof body === 'string') {\n      xhr.send(body);\n    } else if (body) {\n      xhr.send(JSON.stringify(body));\n    } else if (file) {\n      xhr.send(file);\n    } else {\n      xhr.send();\n    }\n\n    requestsUnderway[request.id] = xhr;\n  }).then(function(xhr) {\n    return createResponse(request, xhr);\n  });\n}\n\n// The accessToken argument gives this function flexibility\n// for Mapbox's internal client.\nfunction createRequestXhr(request, accessToken) {\n  var url = request.url(accessToken);\n  var xhr = new window.XMLHttpRequest();\n  xhr.open(request.method, url);\n  Object.keys(request.headers).forEach(function(key) {\n    xhr.setRequestHeader(key, request.headers[key]);\n  });\n  return xhr;\n}\n\nfunction browserSend(request) {\n  return Promise.resolve().then(function() {\n    var xhr = createRequestXhr(request, request.client.accessToken);\n    return sendRequestXhr(request, xhr);\n  });\n}\n\nmodule.exports = {\n  browserAbort: browserAbort,\n  sendRequestXhr: sendRequestXhr,\n  browserSend: browserSend,\n  createRequestXhr: createRequestXhr\n};\n"]},"metadata":{},"sourceType":"script"}